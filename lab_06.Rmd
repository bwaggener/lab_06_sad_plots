---
title: "lab_06"
output: html_document
---
```{r setup, include=FALSE}
library(tidyverse)

```

Get data
```{r load-data}
staff <- read_csv("data/instructional-staff.csv")
```

wide to long 
```{r wide-to-long}
staff_long <- staff %>%
  pivot_longer(cols = -faculty_type, names_to = "year") %>%
  mutate(value = as.numeric(value))
```

plot as a line graph
incorrect line graph

```{r line-graph}
staff_long %>%
  ggplot(aes(x = year, y = value, color = faculty_type)) +
  geom_line()
```



```{r corr_line-graph}
staff_long %>%
  ggplot(aes(
    x = year,
    y = value,
    group = faculty_type,
    color = faculty_type
  )) +
  geom_line()
```


"Suppose the objective of this plot was to show that the proportion of part-time faculty have gone up over time compared to other instructional staff types."

The proportion for each faculty type is value divided by the sum of all values for that year. 

```{r plot-proportion}
staff_long_propor <- staff_long %>%
  group_by(year) %>%
  mutate(
    proportion = value / sum(value)) %>%
  ungroup()
```

```{r plot-proportion1}
library(viridis)

staff_long_propor %>%
  ggplot(aes(
    x = year,
    y = proportion,
    group = faculty_type,
    color = faculty_type,
    fill = faculty_type
  )) +
  geom_area(alpha = 0.8) + 
  scale_fill_viridis_d(option = "viridis") +  
  scale_color_viridis_d(option = "viridis") +
  scale_y_continuous(labels = scales::percent_format()) +
  labs(
    title = "Proportion of Faculty Types Over Time",
    x = "Year",
    y = "Proportion",
    fill = "Faculty Type",
    color = "Faculty Type"
  ) +
  theme_minimal()
```

##Fisheries
"The Fisheries and Aquaculture Department of the Food and Agriculture Organization of the United Nations (FAO) collects data on the fisheries production of different countries. You can find a list of fishery production for various countries in 2016 on this Wikipedia page. The data includes the tonnage of fish captured and farmed for each country. Note that countries whose total harvest was less than 100,000 tons are excluded from the visualization."

"Can you help them improve it? First, brainstorm how you would improve it. Then create the improved visualization and document your changes/decisions with bullet points. It’s ok if some of your improvements are aspirational, i.e. you don’t know how to implement it, but you think it’s a good idea. Implement what you can and leave notes identifying the aspirational improvements that could not be made. (You don’t need to recreate their plots in order to improve them)"

I think I will just plot the data as bars with colors showing the proportion. Additionally I want to group them by their total production.
```{r load-fish}
fish <- read_csv("data/fisheries.csv")
```

```{r mutate-fish}
top_countries <- c("China", "Russia", "Norway", "Malaysia", "Spain", "Nigeria", "France", "Mauritania", "Nambia", "Ghana")

simple_fish <- fish %>%
  mutate(
    country = ifelse(country %in% top_countries, country, "Other")
  ) %>%
  group_by(country) %>%
  summarize(across(where(is.numeric), sum, na.rm = TRUE)) %>%
  ungroup()

```

```{r plot-fish}
library(ggplot2)
library(dplyr)
library(forcats)

fish_longer_filtered <- fish_longer %>%
  filter(total >= 500000)  # Exclude countries with total harvest less than 100,000 tons

# Create an improved plot with a log scale, color differentiation, and better labeling
fish_grouped <- fish_longer_filtered %>%
  mutate(
    total_group = cut(total,
                      breaks = quantile(total, probs = 0:5 / 5, na.rm = TRUE),
                      include.lowest = TRUE,
                      labels = c("Very Low", "Low", "Medium", "High", "Very High"))
  )

# Create a stacked bar plot
ggplot(fish_grouped, aes(
  x = reorder(country, total),  # Order countries by total production
  y = total,
  fill = factor(type),  # Differentiate by capture vs aquaculture
)) +
  geom_bar(stat = "identity", position = "stack") +
  scale_fill_viridis_d(option = "viridis") +  # Use a distinct color palette
  labs(
    title = "Fishery Production by Country and Grouped by Total Production",
    x = "Country",
    y = "Total Production (Tons)",
    fill = "Fishery Type",
    caption = "Groups: Very Low, Low, Medium, High, Very High"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5),
    plot.margin = margin(1, 1, 1, 3)
  ) +
  geom_text(aes(label = total_group), position = position_stack(vjust = 0.5), size = 3, color = "white")  # Show total group on each bar
```


```{r loadpackages}
library(tidyverse)
library(mosaicData)

data(Whickham)
```

### Exercise 1
This data seems to be observational beause I doubt that researchers assigned people to smoke or not smoke and then measured if they died or not. This was likely an observational study where they collected data from the population.

### Exercise 2 and 3
There are 1,314 observations in this dataset. Each observation includes an outcome variable (dead or alive) after 20 years, smoker (no or yes), and age at the start of the study. These were all women.
```{r count}
nrow(Whickham)
```
Visualizing outcome variable
```{r outcomeplot}
Whickham %>%
  ggplot(aes(x = outcome)) +
  geom_bar()
```

Visualizing smoker variable
```{r smokerplot}
Whickham %>%
  ggplot(aes(x = smoker)) +
  geom_bar()
```

Visualizing age variable
```{r ageplot}
Whickham %>%
  ggplot(aes(x = age)) +
  geom_histogram()+
  scale_x_continuous(breaks = seq(0, 100, by = 5))
```

### Exercise 4
I would expect that smoking would be associated with a greater likelyhood of being dead in 20 years compared to nonsmokers.

### Exercise 5
"Create a visualization depicting the relationship between smoking status and health outcome. Briefly describe the relationship, and evaluate whether this meets your expectations. Additionally, calculate the relevant conditional probabilities to help your narrative."
```{r smoke-outcome}
Whickham %>%
  ggplot(aes(x = smoker, fill = outcome)) +
  geom_bar(position = "fill") +
  scale_fill_viridis_d(option = "viridis") +
  labs(
    title = "Health Outcome by Smoking Status",
    x = "Smoker",
    y = "Proportion",
    fill = "Health Outcome"
  ) +
  theme_minimal()
```

It seems that smokers are not more likely to be dead in twenty years compared to nonsmokers which is surprising.

### Exercise 6
"Create a new variable called age_cat"
```{r age_cat}
Whickham <- Whickham %>%
  mutate(age_cat 
         = case_when
         (age <= 44 ~ "18-44",
           age > 44 & age <= 64 ~ "45-64",
           age > 64 ~ "65+"))
```

facet wrap
```{r facet}
Whickham %>%
  ggplot(aes(x = smoker, fill = outcome)) +
  geom_bar(position = "fill") +
  scale_fill_viridis_d(option = "viridis") +
  labs(
    title = "Health Outcome by Smoking Status",
    x = "Smoker",
    y = "Proportion",
    fill = "Health Outcome"
  ) +
  facet_wrap(~age_cat) +
  theme_minimal()
```